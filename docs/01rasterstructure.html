<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>01rasterstructure.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="01rasterstructure.html">1A Rasters</a>
</li>
<li>
  <a href="02rasterplot.html">2A Plot Rasters</a>
</li>
<li>
  <a href="03rasterreproject.html">3S Reproject Rasters</a>
</li>
<li>
  <a href="04rastercalculations.html">4S Raster math</a>
</li>
<li>
  <a href="06vectoropenshapefile.html">6D Vector</a>
</li>
<li>
  <a href="07vectorshapefileattributes.html">7D Shapefile attributes</a>
</li>
<li>
  <a href="08vectorcrs.html">8D? Vectors CRS</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="raster-structure" class="section level3">
<h3>Raster structure</h3>
<p>Questions:</p>
<ul>
<li>What is a raster dataset?</li>
<li>How do I work with and plot raster data in R?</li>
<li>How can I handle missing or bad data values for a raster?</li>
</ul>
<p>Objectives:</p>
<ul>
<li>Describe the fundamental attributes of a raster dataset.</li>
<li>Explore raster attributes and metadata using R.</li>
<li>Import rasters into R using the raster package.</li>
<li>Plot a raster file in R using the ggplot2 package.</li>
<li>Describe the difference between single- and multi-band rasters.</li>
</ul>
<p>Installing the raster and rgdal packages: install.packages(“raster”).</p>
<p>Note that for raster package you might need to install sp package using install.packages(“sp”) as well as install.packages(“rgdal”)</p>
<pre class="r"><code>library(raster)</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre class="r"><code>library(rgdal)</code></pre>
<pre><code>## rgdal: version: 1.4-4, (SVN revision 833)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 2.1.3, released 2017/20/01
##  Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal/gdal
##  GDAL binary built with GEOS: FALSE 
##  Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
##  Path to PROJ.4 shared files: /Library/Frameworks/R.framework/Versions/3.6/Resources/library/rgdal/proj
##  Linking to sp version: 1.3-1</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;ggplot2&#39;:
##   method         from 
##   [.quosures     rlang
##   c.quosures     rlang
##   print.quosures rlang</code></pre>
<pre><code>## ── Attaching packages ──────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.1     ✔ purrr   0.3.2
## ✔ tibble  2.1.3     ✔ dplyr   0.8.1
## ✔ tidyr   0.8.3     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ─────────────────────────────── tidyverse_conflicts() ──
## ✖ tidyr::extract() masks raster::extract()
## ✖ dplyr::filter()  masks stats::filter()
## ✖ dplyr::lag()     masks stats::lag()
## ✖ dplyr::select()  masks raster::select()</code></pre>
<pre class="r"><code># set the ggplot theme to minimal upfront
theme_set(theme_minimal())</code></pre>
<p>You should already have the data…</p>
<p>First, let’s view the Raster file attributes</p>
<p>We will be working with a series of GeoTIFF files in this lesson. The GeoTIFF format contains a set of embedded tags with metadata about the raster data. We can use the function GDALinfo() to get information about our raster data before we read that data into R. It is ideal to do this before importing your data.</p>
<pre class="r"><code>GDALinfo(&quot;data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif&quot;)</code></pre>
<pre><code>## rows        1367 
## columns     1697 
## bands       1 
## lower left origin.x        731453 
## lower left origin.y        4712471 
## res.x       1 
## res.y       1 
## ysign       -1 
## oblique.x   0 
## oblique.y   0 
## driver      GTiff 
## projection  +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs 
## file        data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif 
## apparent band summary:
##    GDType hasNoDataValue NoDataValue blockSize1 blockSize2
## 1 Float64           TRUE       -9999          1       1697
## apparent band statistics:
##     Bmin   Bmax    Bmean      Bsd
## 1 305.07 416.07 359.8531 17.83169
## Metadata:
## AREA_OR_POINT=Area</code></pre>
<p>We can store this information in R</p>
<pre class="r"><code>HARV_dsmCrop_info &lt;- capture.output(
  GDALinfo(&quot;data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif&quot;)
)</code></pre>
<p>Each line of text that was printed to the console is now stored as an element of the character vector HARV_dsmCrop_info. We will be exploring this data throughout this episode. By the end of this episode, you will be able to explain and understand the output above.</p>
</div>
<div id="open-a-raster-in-r" class="section level3">
<h3>Open a Raster in R</h3>
<pre class="r"><code>DSM_HARV &lt;- 
  raster(&quot;data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif&quot;)

DSM_HARV</code></pre>
<pre><code>## class      : RasterLayer 
## dimensions : 1367, 1697, 2319799  (nrow, ncol, ncell)
## resolution : 1, 1  (x, y)
## extent     : 731453, 733150, 4712471, 4713838  (xmin, xmax, ymin, ymax)
## crs        : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
## source     : /Users/darya/Dropbox (Sydney Uni)/Training/19_09_11_ResBaz/19_01_11_ResBazGIS/data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif 
## names      : HARV_dsmCrop 
## values     : 305.07, 416.07  (min, max)</code></pre>
<pre class="r"><code>summary(DSM_HARV)</code></pre>
<pre><code>## Warning in .local(object, ...): summary is an estimate based on a sample of 1e+05 cells (4.31% of all cells)</code></pre>
<pre><code>##         HARV_dsmCrop
## Min.          305.26
## 1st Qu.       345.70
## Median        359.71
## 3rd Qu.       374.36
## Max.          415.10
## NA&#39;s            0.00</code></pre>
<p>Note the warning - unless you force R to calculate these statistics using every cell in the raster, it will take a random sample of 100,000 cells and calculate from that instead. To force calculation on more, or even all values, you can use the parameter maxsamp:</p>
<pre class="r"><code>summary(DSM_HARV, maxsamp = ncell(DSM_HARV))</code></pre>
<pre><code>##         HARV_dsmCrop
## Min.          305.07
## 1st Qu.       345.59
## Median        359.67
## 3rd Qu.       374.28
## Max.          416.07
## NA&#39;s            0.00</code></pre>
<p>Convert it to a dataframe in order to plot it using ggplot2</p>
<pre class="r"><code>DSM_HARV_df &lt;- as.data.frame(DSM_HARV, xy = TRUE)</code></pre>
<p>Can see a standard dataframe format</p>
<pre class="r"><code>str(DSM_HARV_df)</code></pre>
<pre><code>## &#39;data.frame&#39;:    2319799 obs. of  3 variables:
##  $ x           : num  731454 731454 731456 731456 731458 ...
##  $ y           : num  4713838 4713838 4713838 4713838 4713838 ...
##  $ HARV_dsmCrop: num  409 408 407 407 409 ...</code></pre>
<p>Let’s use ggplot to plot the raster.</p>
<p>We will set the color scale to scale_fill_viridis_c which is a color-blindness friendly color scale. We will also use the coord_quickmap() function to use an approximate Mercator projection for our plots. This approximation is suitable for small areas that are not too close to the poles. Other coordinate systems are available in ggplot2 if needed, you can learn about them at their help page ?coord_map. (DEMO this here)</p>
<pre class="r"><code>DSM_HARV_df %&gt;%
  ggplot() +
  geom_raster(aes(x = x, y = y, fill = HARV_dsmCrop)) +   scale_fill_viridis_c() +
  coord_quickmap()</code></pre>
<p><img src="01rasterstructure_files/figure-html/DemoGG-1.png" width="672" /></p>
</div>
<div id="view-raster-coordinate-reference-system-crs-in-r" class="section level3">
<h3>View Raster Coordinate Reference System (CRS) in R:</h3>
<p>We can view the CRS string associated with our R object using the crs() function.</p>
<pre class="r"><code># Challenge: What units are our data in?
crs(DSM_HARV)</code></pre>
<pre><code>## CRS arguments:
##  +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84
## +towgs84=0,0,0</code></pre>
<p>Understanding CRS in Proj4 Format:</p>
<ul>
<li>proj=utm: the projection is UTM, UTM has several zones.</li>
<li>zone=18: the zone is 18</li>
<li>datum=WGS84: the datum is WGS84 (the datum refers to the 0,0 reference for the coordinate system used in the projection)</li>
<li>units=m: the units for the coordinates are in meters</li>
<li>ellps=WGS84: the ellipsoid (how the earth’s roundness is calculated) for the data is WGS84</li>
</ul>
</div>
<div id="calculate-raster-min-and-max-values" class="section level3">
<h3>Calculate Raster Min and Max Values</h3>
<p>It is useful to know the minimum or maximum values of a raster dataset. In this case, given we are working with elevation data, these values represent the min/max elevation range at our site.</p>
<pre class="r"><code>minValue(DSM_HARV)</code></pre>
<pre><code>## [1] 305.07</code></pre>
<pre class="r"><code>maxValue(DSM_HARV)</code></pre>
<pre><code>## [1] 416.07</code></pre>
<p>If the minimum and maximum values haven’t already been calculated, we can calculate them using the setMinMax() function.</p>
<pre class="r"><code>DSM_HARV &lt;- setMinMax(DSM_HARV)</code></pre>
<p>We can use the raster() function to import one single band from a single or multi-band raster. We can view the number of bands in a raster using the nlayers() function.</p>
<pre class="r"><code>nlayers(DSM_HARV)</code></pre>
<pre><code>## [1] 1</code></pre>
</div>
<div id="dealing-with-missing-data" class="section level3">
<h3>Dealing with Missing Data</h3>
<p>Raster data often has a NoDataValue associated with it. This is a value assigned to pixels where data is missing or no data were collected.</p>
<p>Challenge: Use the output from the GDALinfo() function to find out what NoDataValue is used for our DSM_HARV dataset.</p>
<pre class="r"><code>GDALinfo(&quot;data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif&quot;)</code></pre>
<pre><code>## rows        1367 
## columns     1697 
## bands       1 
## lower left origin.x        731453 
## lower left origin.y        4712471 
## res.x       1 
## res.y       1 
## ysign       -1 
## oblique.x   0 
## oblique.y   0 
## driver      GTiff 
## projection  +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs 
## file        data/NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_dsmCrop.tif 
## apparent band summary:
##    GDType hasNoDataValue NoDataValue blockSize1 blockSize2
## 1 Float64           TRUE       -9999          1       1697
## apparent band statistics:
##     Bmin   Bmax    Bmean      Bsd
## 1 305.07 416.07 359.8531 17.83169
## Metadata:
## AREA_OR_POINT=Area</code></pre>
<pre class="r"><code># 9999</code></pre>
</div>
<div id="bad-data-values-in-rasters-are-different-from-nodatavalues" class="section level3">
<h3>Bad Data Values in Rasters are different from NoDataValue(s)</h3>
<p>Examples of Bad Data Values:</p>
<ul>
<li>The normalized difference vegetation index (NDVI), which is a measure of greenness, has a valid range of -1 to 1. Any value outside of that range would be considered a “bad” or miscalculated value.</li>
<li>Reflectance data in an image will often range from 0-1 or 0-10,000 depending upon how the data are scaled. Thus a value greater than 1 or greater than 10,000 is likely caused by an error in either data collection or processing.</li>
</ul>
<div id="find-bad-data-values" class="section level4">
<h4>Find Bad Data Values</h4>
<p>Plotting data with appropriate highlighting can help reveal patterns in bad values and may suggest a solution. Below, reclassification is used to highlight elevation values over 400m with a contrasting colour.</p>
<p>Create A Histogram of Raster Values:</p>
<pre class="r"><code>DSM_HARV_df %&gt;%
  ggplot() +
  geom_histogram(aes(HARV_dsmCrop))</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="01rasterstructure_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code># Challenge
#Use GDALinfo() to determine the following about the NEON-DS-Airborne-Remote-Sensing/HARV/DSM/HARV_DSMhill.tif file:
# 1.Does this file have the same CRS as DSM_HARV?
# 2. What is the NoDataValue?
# 3. hat is resolution of the raster data?
# 4. How large would a 5x5 pixel area be on the Earth’s surface?
# 5. Is the file a multi- or single-band raster?</code></pre>
<ol style="list-style-type: decimal">
<li>If this file has the same CRS as DSM_HARV? Yes: UTM Zone 18, WGS84, meters.</li>
<li>What format NoDataValues take? -9999</li>
<li>The resolution of the raster data? 1x1</li>
<li>How large a 5x5 pixel area would be? 5mx5m How? We are given resolution of 1x1 and units in meters, therefore resolution of 5x5 means 5x5m.</li>
<li>Is the file a multi- or single-band raster? Single.</li>
</ol>
<p>Notice: this file is a hillshade. We will (not) learn about hillshades in the Working with Multi-band Rasters in R episode.</p>
</div>
</div>
<div id="summary" class="section level2">
<h2>Summary!</h2>
<ol style="list-style-type: decimal">
<li><p>The GeoTIFF file format includes metadata about the raster data.</p></li>
<li><p>To plot raster data with the ggplot2 package, we need to convert it to a dataframe.</p></li>
<li><p>R stores CRS information in the Proj4 format.</p></li>
<li><p>Be careful when dealing with missing or bad data values.</p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
