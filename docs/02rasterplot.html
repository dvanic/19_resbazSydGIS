<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>02rasterplot.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="01rasterstructure.html">1A Rasters</a>
</li>
<li>
  <a href="02rasterplot.html">2A Plot Rasters</a>
</li>
<li>
  <a href="03rasterreproject.html">3S Reproject Rasters</a>
</li>
<li>
  <a href="04rastercalculations.html">4S Raster math</a>
</li>
<li>
  <a href="06vectoropenshapefile.html">6D Vector</a>
</li>
<li>
  <a href="07vectorshapefileattributes.html">7D Shapefile attributes</a>
</li>
<li>
  <a href="08vectorcrs.html">8D? Vectors CRS</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="raster-structure" class="section level3">
<h3>Raster structure</h3>
<p>Questions:</p>
<ul>
<li>How can I create categorized or customized maps of raster data?</li>
<li>How can I customize the color scheme of a raster image?</li>
<li>How can I layer raster data in a single image?</li>
</ul>
<p>Objectives:</p>
<ul>
<li>Build customized plots for a single band raster using the ggplot2 package.</li>
<li>Layer a raster dataset on top of a hillshade to create an elegant basemap.</li>
</ul>
<p>This episode covers how to plot a raster in R using the ggplot2 package with customized coloring schemes. It also covers how to layer a raster on top of a hillshade to produce an eloquent map. We will continue working with the Digital Surface Model (DSM) raster for the NEON Harvard Forest Field Site.</p>
</div>
<div id="plot-raster-data-in-r-with-breaks" class="section level3">
<h3>Plot Raster Data in R with breaks</h3>
<p>In the previous episode, we viewed our data using a continuous color ramp. For clarity and visibility of the plot, we may prefer to view the data “symbolized” or colored according to ranges of values. This is comparable to a “classified” map. To do this, we need to tell ggplot how many groups to break our data into, and where those breaks should be. To make these decisions, it is useful to first explore the distribution of the data using a bar plot. To begin with, we will use dplyr’s mutate() function combined with cut() to split the data into 3 bins.</p>
<pre class="r"><code>DSM_HARV_df &lt;- DSM_HARV_df %&gt;% mutate(fct_elevation = cut(HARV_dsmCrop, breaks = 3))

DSM_HARV_df %&gt;%
ggplot() +
    geom_bar(aes(fct_elevation))</code></pre>
<p><img src="02rasterplot_files/figure-html/DataBreaks-1.png" width="672" /></p>
<p>If we want to know the cutoff values for the groups, we can ask for the unique values of fct_elevation:</p>
<pre class="r"><code>unique(DSM_HARV_df$fct_elevation)</code></pre>
<pre><code>## [1] (379,416] (342,379] (305,342]
## Levels: (305,342] (342,379] (379,416]</code></pre>
<p>And we can get the count of values in each group using dplyr’s group_by() and count() functions:</p>
<pre class="r"><code>DSM_HARV_df %&gt;%
        group_by(fct_elevation) %&gt;%
        count()</code></pre>
<pre><code>## # A tibble: 3 x 2
## # Groups:   fct_elevation [3]
##   fct_elevation       n
##   &lt;fct&gt;           &lt;int&gt;
## 1 (305,342]      418891
## 2 (342,379]     1530073
## 3 (379,416]      370835</code></pre>
<p>We might prefer to customize the cutoff values for these groups. Lets round the cutoff values so that we have groups for the ranges of 301–350 m, 351–400 m, and 401–450 m. To implement this we will give mutate() a numeric vector of break points instead of the number of breaks we want.</p>
<pre class="r"><code>DSM_HARV_df &lt;- DSM_HARV_df %&gt;%
  mutate(fct_elevation_2 = cut(HARV_dsmCrop, 
                               breaks = c(300, 350, 400, 450)))

unique(DSM_HARV_df$fct_elevation_2)</code></pre>
<pre><code>## [1] (400,450] (350,400] (300,350]
## Levels: (300,350] (350,400] (400,450]</code></pre>
<p>And now we can plot our bar plot again, using the new groups:</p>
<pre class="r"><code>ggplot() +
  geom_bar(data = DSM_HARV_df, aes(fct_elevation_2))</code></pre>
<p><img src="02rasterplot_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>As we did earlier, we can get the count of values in each group:</p>
<pre class="r"><code>DSM_HARV_df %&gt;%
  group_by(fct_elevation_2) %&gt;%
  count()</code></pre>
<pre><code>## # A tibble: 3 x 2
## # Groups:   fct_elevation_2 [3]
##   fct_elevation_2       n
##   &lt;fct&gt;             &lt;int&gt;
## 1 (300,350]        741815
## 2 (350,400]       1567316
## 3 (400,450]         10668</code></pre>
<p>Using ggplot ploting each group with a different color:</p>
<pre class="r"><code>DSM_HARV_df %&gt;%
  ggplot() +
  geom_raster(aes(x = x, y = y, fill = fct_elevation_2)) + 
  coord_quickmap()</code></pre>
<p><img src="02rasterplot_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>In the above plot, the default colours are used for the raster objects. We can make the figure nicer by specifying the colours ourselves. We can use a special colour pallette called terrain.colors().</p>
<p>The terrain.colors() function returns hex colors - each of these character strings represents a color. To use these in our map, we pass them across using the scale_fill_manual() function.</p>
<pre class="r"><code>terrain.colors(3)</code></pre>
<pre><code>## [1] &quot;#00A600FF&quot; &quot;#ECB176FF&quot; &quot;#F2F2F2FF&quot;</code></pre>
<pre class="r"><code>DSM_HARV_df %&gt;%
  ggplot() +
 geom_raster(aes(x = x, y = y, fill = fct_elevation_2)) +
  scale_fill_manual(values = terrain.colors(3), name = &quot;Elevation&quot;) + coord_quickmap() + 
  # get rid of axes titles (demo this slowly)
  theme(axis.title = element_blank())</code></pre>
<p><img src="02rasterplot_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code># Challenge:
# 
# Create a plot of the Harvard Forest Digital Surface Model (DSM) that has:
# 1. Six classified ranges of values (break points) that are evenly divided among the range of pixel values.
# 2. Axis labels.
# 3. A plot title.

DSM_HARV_df &lt;- DSM_HARV_df  %&gt;%
               mutate(fct_elevation_6 = cut(HARV_dsmCrop, breaks = 6)) 

DSM_HARV_df %&gt;%
  ggplot() +
  geom_raster(aes(x = x, y = y,fill = fct_elevation_6)) +
  scale_fill_manual(values = terrain.colors(6), name = &quot;Elevation&quot;) +
  ggtitle(&quot;Classified Elevation Map - NEON Harvard Forest Field Site&quot;) +
  xlab(&quot;UTM Westing Coordinate (m)&quot;) +
  ylab(&quot;UTM Northing Coordinate (m)&quot;) + 
  coord_quickmap()</code></pre>
<p><img src="02rasterplot_files/figure-html/Ch4-1.png" width="672" /></p>
</div>
<div id="summary" class="section level3">
<h3>Summary</h3>
<ol style="list-style-type: decimal">
<li>Continuous data ranges can be grouped into categories using mutate() and cut().</li>
<li>Use built-in terrain.colors() or set your preferred color scheme manually.</li>
<li>Layer rasters on top of one another by using the alpha aesthetic.</li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
