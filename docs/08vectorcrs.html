<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>08vectorcrs.utf8.md</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="01rasterstructure.html">1A Rasters</a>
</li>
<li>
  <a href="02rasterplot.html">2A Plot Rasters</a>
</li>
<li>
  <a href="03rasterreproject.html">3S Reproject Rasters</a>
</li>
<li>
  <a href="04rastercalculations.html">4S Raster math</a>
</li>
<li>
  <a href="06vectoropenshapefile.html">6D Vector</a>
</li>
<li>
  <a href="07vectorshapefileattributes.html">7D Shapefile attributes</a>
</li>
<li>
  <a href="08vectorcrs.html">8D? Vectors CRS</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">




</div>


<div id="vector-crs" class="section level3">
<h3>Vector CRS</h3>
<ul>
<li>Questions: What do I do when vector data don’t line up?</li>
<li>Objectives: Plot vector objects with different CRSs in the same plot.</li>
</ul>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Linking to GEOS 3.6.1, GDAL 2.1.3, PROJ 4.9.3</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;ggplot2&#39;:
##   method         from 
##   [.quosures     rlang
##   c.quosures     rlang
##   print.quosures rlang</code></pre>
<pre><code>## ── Attaching packages ──────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.1     ✔ purrr   0.3.2
## ✔ tibble  2.1.3     ✔ dplyr   0.8.1
## ✔ tidyr   0.8.3     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ─────────────────────────────────────── tidyverse_conflicts() ──
## ✖ tidyr::extract() masks raster::extract()
## ✖ dplyr::filter()  masks stats::filter()
## ✖ dplyr::lag()     masks stats::lag()
## ✖ dplyr::select()  masks raster::select()</code></pre>
<pre><code>## Reading layer `HARVtower_UTM18N&#39; from data source `/Users/darya/Dropbox (Sydney Uni)/Training/19_09_11_ResBaz/19_01_11_ResBazGIS/data/NEON-DS-Site-Layout-Files/HARV/HARVtower_UTM18N.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 14 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 732183.2 ymin: 4713265 xmax: 732183.2 ymax: 4713265
## epsg (SRID):    32618
## proj4string:    +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs</code></pre>
<pre><code>## Reading layer `HarClip_UTMZ18&#39; from data source `/Users/darya/Dropbox (Sydney Uni)/Training/19_09_11_ResBaz/19_01_11_ResBazGIS/data/NEON-DS-Site-Layout-Files/HARV/HarClip_UTMZ18.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 1 field
## geometry type:  POLYGON
## dimension:      XY
## bbox:           xmin: 732128 ymin: 4713209 xmax: 732251.1 ymax: 4713359
## epsg (SRID):    32618
## proj4string:    +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs</code></pre>
</div>
<div id="case-scenario" class="section level3">
<h3>Case scenario:</h3>
<ul>
<li>Working With Spatial Data From Different Sources</li>
</ul>
<p>Some reasons for data being in different CRSs include:</p>
<ol style="list-style-type: decimal">
<li>The data are stored in a particular CRS convention used by the data provider (for example, a government agency).</li>
<li>The data are stored in a particular CRS that is customized to a region. For instance, many states in the US prefer to use a State Plane projection customized for that state.</li>
</ol>
<p>There are R packages for accessing US census data, and Australian census data - eechidna.</p>
<div id="read-us-boundary-file" class="section level4">
<h4>Read US Boundary File</h4>
<pre class="r"><code>state_boundary_US &lt;- st_read(&quot;data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-State-Boundaries-Census-2014.shp&quot;)</code></pre>
<pre><code>## Reading layer `US-State-Boundaries-Census-2014&#39; from data source `/Users/darya/Dropbox (Sydney Uni)/Training/19_09_11_ResBaz/19_01_11_ResBazGIS/data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-State-Boundaries-Census-2014.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 58 features and 10 fields
## geometry type:  MULTIPOLYGON
## dimension:      XYZ
## bbox:           xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<pre class="r"><code>state_boundary_US %&gt;%
  ggplot() +
  geom_sf() +
  ggtitle(&quot;Map of Contiguous US State Boundaries&quot;) +
  coord_sf()</code></pre>
<p><img src="08vectorcrs_files/figure-html/plot-1.png" width="672" /></p>
<p>Add a boundary layer of the United States to our map - to make it look nicer.</p>
<pre class="r"><code>country_boundary_US &lt;- st_read(&quot;data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-Boundary-Dissolved-States.shp&quot;)</code></pre>
<pre><code>## Reading layer `US-Boundary-Dissolved-States&#39; from data source `/Users/darya/Dropbox (Sydney Uni)/Training/19_09_11_ResBaz/19_01_11_ResBazGIS/data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/US-Boundary-Dissolved-States.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 1 feature and 9 fields
## geometry type:  MULTIPOLYGON
## dimension:      XYZ
## bbox:           xmin: -124.7258 ymin: 24.49813 xmax: -66.9499 ymax: 49.38436
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>If we specify a thicker line width using size = 2 for the border layer, it will make our map pop! We will also manually set the colors of the state boundaries and country boundaries.</p>
<pre class="r"><code>country_boundary_US %&gt;%
  ggplot() +
  geom_sf(color = &quot;gray18&quot;, size = 2) +
  geom_sf(data = state_boundary_US, color = &quot;gray40&quot;) +
  ggtitle(&quot;Map of Contiguous US State Boundaries&quot;) +
  coord_sf()</code></pre>
<p><img src="08vectorcrs_files/figure-html/unnamed-chunk-2-1.png" width="672" /> Next, let’s add the location of a flux tower where our study area is. As we are adding these layers, take note of the CRS of each object.</p>
<p>We saw in an earlier episode that when working with raster data in different CRSs, we needed to convert all objects to the same CRS. We can do the same thing with our vector data - however, we don’t need to! When using the ggplot2 package, ggplot automatically converts all objects to the same CRS before plotting. This means we can plot our three data sets together without doing any conversion:</p>
<pre class="r"><code>country_boundary_US %&gt;%
  ggplot() +
  geom_sf(size = 2, color = &quot;gray18&quot;) +
  geom_sf(data = state_boundary_US, color = &quot;gray40&quot;) +
  geom_sf(data = point_HARV, shape = 19, color = &quot;purple&quot;) +
  ggtitle(&quot;Map of Contiguous US State Boundaries&quot;) +
  coord_sf()</code></pre>
<p><img src="08vectorcrs_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>But not all libraries are this convenient, and it doesn’t help us with vector math!</p>
<p>Let’s get them into the same CRS:</p>
<pre class="r"><code>st_crs(point_HARV)</code></pre>
<pre><code>## Coordinate Reference System:
##   EPSG: 32618 
##   proj4string: &quot;+proj=utm +zone=18 +datum=WGS84 +units=m +no_defs&quot;</code></pre>
<pre class="r"><code>st_crs(state_boundary_US)</code></pre>
<pre><code>## Coordinate Reference System:
##   EPSG: 4326 
##   proj4string: &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</code></pre>
<pre class="r"><code>st_crs(country_boundary_US)</code></pre>
<pre><code>## Coordinate Reference System:
##   EPSG: 4326 
##   proj4string: &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</code></pre>
<p>To convert:</p>
<pre class="r"><code>point_HARV_4326 &lt;- st_transform(point_HARV, 4326)
st_transform(point_HARV, st_crs(state_boundary_US))</code></pre>
<pre><code>## Simple feature collection with 1 feature and 14 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -72.17266 ymin: 42.5369 xmax: -72.17266 ymax: 42.5369
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##   Un_ID Domain DomainName       SiteName Type       Sub_Type     Lat
## 1     A      1  Northeast Harvard Forest Core Advanced Tower 42.5369
##        Long Zone  Easting Northing                Ownership    County
## 1 -72.17266   18 732183.2  4713265 Harvard University, LTER Worcester
##   annotation                  geometry
## 1         C1 POINT (-72.17266 42.5369)</code></pre>
<pre class="r"><code>st_transform(point_HARV, as.character(st_crs(state_boundary_US))[2])</code></pre>
<pre><code>## Simple feature collection with 1 feature and 14 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -72.17266 ymin: 42.5369 xmax: -72.17266 ymax: 42.5369
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##   Un_ID Domain DomainName       SiteName Type       Sub_Type     Lat
## 1     A      1  Northeast Harvard Forest Core Advanced Tower 42.5369
##        Long Zone  Easting Northing                Ownership    County
## 1 -72.17266   18 732183.2  4713265 Harvard University, LTER Worcester
##   annotation                  geometry
## 1         C1 POINT (-72.17266 42.5369)</code></pre>
<pre class="r"><code># Create a map of the North Eastern United States as follows:
# 1. Import and plot Boundary-US-State-NEast.shp. Adjust line width as necessary.
# 2. Layer the Fisher Tower (in the NEON Harvard Forest site) point location point_HARV onto the plot.
# 3. Add a title.
# 4. Add a legend that shows both the state boundary (as a line) and the Tower location point.
NE.States.Boundary.US &lt;- st_read(&quot;data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/Boundary-US-State-NEast.shp&quot;)</code></pre>
<pre><code>## Reading layer `Boundary-US-State-NEast&#39; from data source `/Users/darya/Dropbox (Sydney Uni)/Training/19_09_11_ResBaz/19_01_11_ResBazGIS/data/NEON-DS-Site-Layout-Files/US-Boundary-Layers/Boundary-US-State-NEast.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 12 features and 9 fields
## geometry type:  MULTIPOLYGON
## dimension:      XYZ
## bbox:           xmin: -80.51989 ymin: 37.91685 xmax: -66.9499 ymax: 47.45716
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre>
<pre class="r"><code>NE.States.Boundary.US %&gt;% 
  ggplot() +
    geom_sf(aes(color =&quot;color&quot;), show.legend = &quot;line&quot;) +
    scale_color_manual(name = &quot;&quot;, labels = &quot;State Boundary&quot;, values = c(&quot;color&quot; = &quot;gray18&quot;)) +
    geom_sf(data = point_HARV_4326, aes(shape = &quot;shape&quot;), color = &quot;purple&quot;) +
    scale_shape_manual(name = &quot;&quot;, labels = &quot;Fisher Tower&quot;, values = c(&quot;shape&quot; = 19)) +
    ggtitle(&quot;Fisher Tower location&quot;) +
    theme(legend.background = element_rect(color = NA)) +
    coord_sf()</code></pre>
<p><img src="08vectorcrs_files/figure-html/Challenge4-1.png" width="672" /></p>
</div>
</div>
<div id="crop-a-raster-to-vector-extent" class="section level2">
<h2>Crop a Raster to Vector Extent</h2>
</div>
<div id="extract-values-from-raster-using-spatial-data" class="section level2">
<h2>Extract values from raster using spatial data</h2>
<pre class="r"><code>CHM_HARV_Cropped &lt;- crop(x = CHM_HARV, y = as(aoi_boundary_HARV, &quot;Spatial&quot;))</code></pre>
<pre class="r"><code>plot(CHM_HARV)
plot(aoi_boundary_HARV, add=TRUE,lwd=2,col=NA)</code></pre>
<p><img src="08vectorcrs_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>plot(CHM_HARV_Cropped)</code></pre>
<p><img src="08vectorcrs_files/figure-html/unnamed-chunk-6-2.png" width="672" /></p>
<pre class="r"><code>mean_tree_height_tower &lt;- raster::extract(x = CHM_HARV, y = as(point_HARV, &quot;Spatial&quot;), buffer = 20, fun = mean)</code></pre>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
